<html>
<head>
  <link rel="stylesheet" href="user_guide.css">
</head>
<body>

    

<h1>Software</h1>
    
   <div class="header">
        <p>Last updated Jan 11, 2022 by Leanne Friedrich<p>

        <p><i>Certain commercial equipment, instruments, or materials are identified in this user guide in order to describe a specific device. Such identification is not intended to imply recommendation or endorsement by the National Institute of Standards and Technology, nor is it intended to imply that the materials or equipment identified are necessarily the best available for the purpose.</i></p>

       <p> <a href="user_guide.html">Home</a><p>
        <p> <a href="software.html">Software</a> </p>
        <p>
            <b><a href="hardware.html">Hardware</a></b> || <a href="parts_list.html">Parts list</a> || <a href="stage_assembly.html">Stage</a> || <a href="nozzle_assembly.html">Nozzle</a> || <a href="imaging_assembly.html">Imaging</a> || <a href="UV_assembly.html">UV curing</a> || <a href="enclosure.html">Enclosure</a>
        </p>
        
        <hr>
    </div>
    
    <h2>Getting started</h2>
    
    <p>This software was written for Windows. Certain elements, like folder opening buttons <img src="../pythonGUI/icons/link.png" class="icon2"> and the system that tracks whether the pressure should be on or off during prints, will break outside of Windows.</p>
    
    <ol>
        <li>Install Python</li>
        <ul>
            <li>For example, install <a href="https://docs.conda.io/en/latest/miniconda.html" rel="noopener noreferrer" target="_blank">Miniconda</a></li>
        </ul>
        <li>Download the software from <a href="https://github.com/usnistgov/ShopbotPyQt" rel="noopener noreferrer" target="_blank">Github</a>. Because this software is continually updated, you can keep the most updated version of the code by cloning the repository through Github. For beginners:</li>
        <ul>
            <li>Download <a href="https://desktop.github.com/" rel="noopener noreferrer" target="_blank">Github desktop</a></li>
            <li>Create a <a href="https://github.com/join" rel="noopener noreferrer" target="_blank">Github account</a></li>
            <li>In Github desktop, clone <a href="https://github.com/usnistgov/ShopbotPyQt" rel="noopener noreferrer" target="_blank">the ShopbotPyQt repository</a></li>
            <li>To update your software to the latest version, click "Fetch Origin" in Github Desktop at any time.</li>
        </ul>
        <li>Install <a href="https://www.shopbottools.com/support/control-software">the Shopbot control software</a></li>
        <ul>
            <li> By default, the Shopbot control software shows 4 output flags, but it allows 12. To increase the number of visible output flags for signaling additional devices (e.g. pressure channels, lights, etc.), go into Move/Cut Mode. Once in Move/Cut - right click in the input/output section of the red position window. Here you can set the number of inputs/outputs displayed up to 12 in the red window</li>
            <li>You will need to start up Shopbot independently the first time. For the pop-up message that occurs, check the box to not show the message again. Load all the setting you will need into shopbot at this time. </li>
        </ul>
        
        <li>Install <a href="https://ultimaker.com/software/ultimaker-cura">Ultimaker Cura</a> slicer. Save it to the system's 'program files' folder</li>
        <ul>
            <li>Create a free ultimaker account</li>
            <li>Once downloaded and opened, go to the setting tab and add printer. Under the 'add a non-networked printer', there should be a 'custom' option with a drop down menu. Click on the 'Custom FFF printer' and rename it to your preference.</li>
            <li>A 'machine setting' window should pop up, where you will place corresponding variables to the printer.</li>
            <li> <img src="img/cura_variables.png" alt="Variable inputs that correspond to ShopBot for the Cura slicer"></li>
            <li>Set the print resolution to extra coarse - 0.6mm and unclick the Adhesion box and Support box in the same window</li>
            <li>Within the print settings 'Custom', make certain the 'Infill' section's density is set to 0.0, the 'Support' section's Generate Support box is unchecked, and the 'Build Plate Adhesion' type is set to None. </li>
            <li>Essentially, any supports for the structure are redundant as it is already supported in the bath. It will only cause excess ink to be extruded and ruin your print.</li>
            <li>Note that the Cura slicer takes 1/3 inch off the edges, so you can add that much to the X/Y/Z measurements. However, measurements of 42.34mm by 103.14mm will have you go past the container dimensions.
</li>
            <li>When creating an STL file through <a href="https://www.onshape.com/en/">Onshape</a>, create measurements in millimeters, even if it states in inches. Cura assumes all measurements are in millimeters.</li>
        </ul>

        <li><a href="https://boscacci.medium.com/why-and-how-to-make-a-requirements-txt-f329c685181e">Install Python packages</a> listed in <i>requirements.txt</i>. </li>
        <li>Launch the GUI.</li>
        <ul>
            <li>In Miniconda: <span class="code">python "MyGithubPath\ShopbotPyQt\pythonGUI\sbgui.py"</span>, replacing "MyGitHubPath" with your full github path.</li>
            <li>In a Jupyter console from the pythonGUI folder: <span class="code">run sbgui.py</span></li>
        </ul>
    </ol>
    
    <h2>Using the GUI</h2>
    
    <h3>Menu</h3>
    <details>
      <summary>
          <span class="icon">▼</span><span class="open_text">Open</span><span class="close_text">Close</span>
      </summary>
    <img src="img/updated_software_header.png"  class="graphic" alt="header menu of the GUI. Menu buttons are Log, speed calibration tool, and settings">
    
    <ul>
        <li>The "log" button opens a separate window holding a log of all of the status updates in all of the windows.</li>
        <li>The "speed calibration tool" button opens a separate window holding the flow rate calibration tool.</li>
        <li>The "convert" button opens a separate window holding the file conversion tool.</li>
        <li>The "settings" <img src="../pythonGUI/icons/settings.png" class="icon2"> button opens a separate window that holds settings for all of the modules</li>
    </ul>
    </details>
    
    <h3>Settings</h3>
    <details>
      <summary>
          <span class="icon">▼</span><span class="open_text">Open</span><span class="close_text">Close</span>
      </summary>
    
        <img src="img/software_settings_load.png" class="graphic" alt="The load/save tab of the settings module. There are 2 buttons and a checkbox that pertain to loading and saving settings configurations.">
        
        <p>All of the settings can be collectively saved to a .yml file via "Save settings to file." A previously saved settings file can be loaded via "Load settings from file". The checkbox "Save settings for next session" automatically saves all settings to configs/config.yml when the GUI is closed. configs/config.yml is automatically loaded on startup of the GUI.</p>
        
    </details>
    
     <h3>Conversion Tool</h3>
    <details>
      <summary>
          <span class="icon">▼</span><span class="open_text">Open</span><span class="close_text">Close</span>
      </summary>
    
        <img src="img/conversion_sample.png" alt="File conversion window. The window has fields for loading and saving files, as well as adding to queue.">
        
        <p>The conversion window can currently take in both STL and GCODE files to be converted into an SBP file. However, if an STL file is inserted, the GUI will only open the Cura slicer. You must first create the GCODE file, save it, and then choose the file within the GUI.</p>
        <li>To add a file to convert, click the "Load File" button. The file name will then be displayed.</li>
        <li>If there is a need to change the name of the save file, you can update it within the textbox for 'saving file under name of'. </li>
        <li>To save the SBP file to the same location as the original file, click the 'save to file folder' button. Otherwise, a new save location can be selected by clicking the 'choose save location' button. You cannot choose a save location while the checkbox is selected.</li>
        <li>To change between flow channels for the resulting sbp file, select between radio buttons "Channel 0" and "Channel 1"</li>
        <li>To add the SBP file to the Shopbot queue, click the 'load to queue after conversion' checkbox.</li>
        <li>To run the conversion on the selected file, click the 'convert file' button. The window should close automatically.</li>
        <li>If you exit out of the window accidentally, the window keeps all previous settings. This includes when there is a successful conversion.</li>
        <p>Currently, the conversion program must override a method within sbprint.py that obtains the flow speed. As a result, set target speed in the speed calibration tool between 1 and 10 to start with, and adjust from there. </p>
        
    </details>
    
    
    <h3>Speed calibration tool</h3>
    <details>
      <summary>
          <span class="icon">▼</span><span class="open_text">Open</span><span class="close_text">Close</span>
      </summary>
        <img src="img/software_pressure_calibration.png" class="diagram" alt="Pressure calibration software window. The window has fields for sample info and intended speeds. At the bottom is a grid of collected values. At the right is a plot of the collected values and a best fit curve.">
        <img src="img/software_fluigent.png" class="graphic" alt="Fluigent pressure controller module. The top section has buttons and fields to request specific pressures, indefinitely or for a finite time. The bottom section has a graph of pressure over time.">
        
        <p>Each time a new ink is loaded onto the printer, the pressure should be calibrated. Pressures can vary based on ink rheology, length of tubing, and pinch points in the tubing. The calibration process is as follows:</p>
        
        <ol>
            <li>Load ink of known density onto printer. Start flow until the tubing is completely full, and ink is exiting the nozzle.</li>
            <li>If you have previously saved the density for this fluid, select the sample from the "Load density" menu. If you type the beginning of the sample name into the "Sample" field, it will narrow the "Load density" list down to samples that start with that value. Selecting an ink loads the Sample name and Density</li>
            <li>If you have not previously loaded the density for this fluid, fill in the "Sample" and "Density" fields. Clicking "Save" will store this new density in the density.yml file in the configs folder, so it will be available the next time you load the sample</li>
            <li>Fill in the nozzle inner diameter.</li>
            <li>Fill in the target flow speed</li>
            <li>Mass the container. Fill in "init wt" in row 1. Place container under nozzle.</li>
            <li>In the Fluigent module, put a pressure, e.g. 100, into the "Set pressure" box. Put a time, e.g. 15, into the "fixed time" box. Press "Go", next to the fixed time box. This will turn on the pressure to, e.g. 100 mBar for 15 seconds, then turn it off. It will automatically put the values for pressure and time into the top available row in the calibration table.</li>
            <li>Mass the container. Fill in "final wt" in row 1. This will automatically fill in the "speed" value for row 1 and plot it on the graph.</li>
            <li>Repeat previous 3 steps at varying pressures, filling in rows 2 and beyond until the calibration curve no longer shifts with additional points.</li>
            <li>When you are done with calibration, click "Use this pressure". This will take the "Pressure" value for the given target speed and fill the pressure into the "Shopbot" module, so Channel 1 will turn to that pressure during printing. You can also fill this value in manually in the "Shopbot" module.</li>
            <li>Click "Save" to save the entire calibration table and metadata to the export folder designated in "Settings"<img src="../pythonGUI/icons/settings.png" class="icon2"> </li>
        </ol>

    </details>
    
    <h3>Shopbot</h3>
    <details>
      <summary>
          <span class="icon">▼</span><span class="open_text">Open</span><span class="close_text">Close</span>
      </summary>
    <img src="img/software_shopbot.png" class="diagram" alt="The Shopbot control module. On the left is a Play button, Load button, and Remove file button. On the right is a status bar a list of files. On bottom is a box for the Pressure during printing.">
    <p>The Shopbot module uses a file queue. The current file is marked with a "Play" <img src="../pythonGUI/icons/play.png" class="icon2"> icon. The "Play" <img src="../pythonGUI/icons/play.png" class="icon2"> button sends the current file to the SB3 Shopbot program, which runs the file. Once the file is done, the current file proceeds to the next file. You can use the settings <img src="../pythonGUI/icons/settings.png" class="icon2">  menu to determine whether to autoplay the next file or wait for the user to press play again.<p>
        <ul>
            <li>To add files to the end of the queue, click the "load" <img src="../pythonGUI/icons/open.png" class="icon2"> button. You can load multiple files at once. To load the same file multiple times, you must use the "load"s button multiple times.</li>
            <li>To remove files, click once on each file, then click the "remove" <img src="../pythonGUI/icons/delete.png" class="icon2"> button.</li>
            <li>To re-order the files, click and drag.</li>
            <li>To select a file as the current file to send to the Shopbot, double click on the file.</li>
            <li>To set the pressure that the pressure controller goes to during printing, use the "pressure during print" box. This can be filled in using the "Use this pressure" button in the speed calibration tool or filled in manually.</li>
        </ul>
        
        <img src="img/software_settings_shopbot.png" class="graphic" alt="The Shopbot tab of the settings window. There are options for autoplaying files and setting the Shopbot file source folder.">
        
        <p>In the settings menu, the user can decide whether or not to autoplay files. You can either automatically start the next file once the first Shopbot file is done, or you can wait for the user to press play on each Shopbot file.</p>
        
        <p>The folder that opens when the user clicks the "load" <img src="../pythonGUI/icons/open.png" class="icon2"> button on the main Shopbot module can be set via the settings. The "load" <img src="../pythonGUI/icons/open.png" class="icon2"> button sets the Shopbot file folder. The "link" <img src="../pythonGUI/icons/link.png" class="icon2"> button opens the Shopbot file folder in Windows Explorer.</p>
        
    </details>
    
    <h3>Export</h3>
    <details>
      <summary>
          <span class="icon">▼</span><span class="open_text">Open</span><span class="close_text">Close</span>
      </summary>
        <img src="img/software_export.png" class="graphic">
        <p>The export settings module sets where files will be saved, what they will be named, and which files to save.</p>
        <ul>
            <li>Use the "Load" <img src="../pythonGUI/icons/open.png" class="icon2"> button to select the folder where files will be exported.</li>
            <li>The folder status bar shows what folder files will be exported into</li>
            <li>The "Link" <img src="../pythonGUI/icons/link.png" class="icon2">  button opens the folder in Windows Explorer</li>
            <li>The value in the "Sample name" field is added to all exported files. Depending on the values in the Settings <img src="../pythonGUI/icons/settings.png" class="icon2"> window, the "Sample name" is also the name of the subfolder into which all files are exported.</li>
            <li>The camera buttons <img src="../pythonGUI/icons/nosave.png" class="icon2">  can be toggled to automatically save or not save videos of the entire print when a file is sent to the Shopbot. The "Basler camera" is the high-resolution camera. The "Nozzle camera" is a webcam pointed at the nozzle. "Webcam 2" is pointed at the entire Shopbot.</li>
        </ul>
        
        <img src="img/software_settings_export.png" class="graphic" alt="The export tab of the settings window. There are various checkboxes and fields to determine how to name files.">
        
        <p>The settings box contains many options for how to name folders. A folder is automatically created for each sample. A subfolder can be automatically created for each shopbot print file.</p>
        
        <ul>
            <li>To create a subfolder for each sample, select "Create folders"</li>
            <li>To include the sample name in the file name, select "Include sample: In file name"</li>
            <li>To include the sample name in the new folder, select "Include sample: In folder name"</li>
            <li>To make the folder name "[Sample]_[Date]", select "Include date: In sample folder name"</li>
            <li>To create an extra date subfolder inside of the sample folder, such that the folder will be "[Sample]/[Date]", select "Include date: As sample folder name".</li>
            <li>To only put the sample name in the folder and have no separate folder for each date, such that the folder will be "[Sample]", select "Include date: in no folder name".</li>
            <li>To include the time in the file name, select, "Include time: in file name"</li>
            <li>To include the shopbot .sbp file name in the sample folder name, such that the folder name will be "[Sample]_[Date]_[ShopbotFile]", select "Include SB file name: In sample folder name".</li>
            <li>To include the shopbot .sbp file name in the sample subfolder name, such that the folder name will be "[Sample]_[Date]/[ShopbotFile]", select "Include SB file name: As sample subfolder name".</li>
            <li>To leave the shopbot .sbp file name out of the folder names, select "Include SB file name: In no folder name"</li>
            <li>To include the shopbot .sbp file name in the file names, (e.g. a video file will be labeled by what shopbot file was being printed), select "Include SB file name: in file name"</li>
            <li>To change how the date is formatted in file names and folder names, change the "Date format" box. Use the <a href="https://www.geeksforgeeks.org/python-strftime-function/">Python strftime format.</a></li>
            <li>To change how the time is formatted in file names and folder names, change the "Time format" box. It is recommended that the time format include the date, since the date will not otherwise be added to file names. Use the <a href="https://www.geeksforgeeks.org/python-strftime-function/">Python strftime format.</a></li>
            <li>Duplicate suffix is the format to use if there is already an file with the name that you are requesting, and the program needs to add a suffix to the filename to avoid overwriting the existing file. {0:0=3d} adds a 3 digit counter to the end, e.g. 012</li>
            <li>Separator is the character to place in between parts of the file name. E.g. "_" might produce a file called "[Shopbot file name]_[device]_[date].[extension]", and "-" would produce a file called "[Shopbot file name]-[device]-[date].[extension]". </li>
            <li>A sample file name is provided at the bottom of the page and should automatically update.</li>
        </ul>
            
        
    </details>
    
    <h3>Cameras</h3>
    <details>
      <summary>
          <span class="icon">▼</span><span class="open_text">Open</span><span class="close_text">Close</span>
      </summary>
        <img src="img/software_camera.png" class="graphic" alt="Basler camera module with three buttons: start preview, start recording, and snapshot.">
        <img src="img/software_camera_2.png" class="graphic" alt="Basler camera module with three buttons: start preview, start recording, and snapshot.">
        <p>Each camera has its own module. The Basler camera is the high-resolution camera, and the nozzle camera and webcam 2 are webcams. </p>
            
        <ul>
               <li>To start the live camera preview, click the "start preview" <img src="../pythonGUI/icons/closedeye.png" class="icon2"> button.</li>
            <li>To stop the live camera preview, click the "stop preview" <img src="../pythonGUI/icons/eye.svg" class="blackIcon">button.
            <li>To start recording, click the "start recording" <img src="../pythonGUI/icons/Record.png" class="icon2"> button. The status bar will show how long the video has been recording, and how many frames have been lost during recording. Lost frames are filled in with duplicates from the last recorded frame, so videos should be as long as the recording time.</li>
            <li>To stop recording and save, click the "stop recording" <img src="../pythonGUI/icons/recordStop.png" class="icon2"> button. The status bar will show how many frames have been written to file.</li>
            <li>To take a single still, click the "snapshot" <img src="../pythonGUI/icons/camera.png" class="icon2"> button.</li>
        </ul>
        
        <img src="img/software_settings_basler.png" class="graphic" alt="The Basler camera tab of the settings window. Each camera has its own tab. There are options for how many messages to log, frame rate, and exposure.">
        
        <p>Each camera has its own tab on the settings module.</p>
        
        <ul>
            <li> To log a status update for each frame, change the "log" setting to "All frames". To only log important status updates, select "Just critical". To keep all messages out of the log window, select "None".</li>
            <li> To maximize the frame rate, set the frame rate to a low value (e.g. 1), set the exposure through the "Exposure" field, type [Enter] or click "Save", then click "Auto" next to the Frame rate field.</li>
            <li>To manually set the frame rate, complete the Frame rate field and type [Enter] or click "Save". If the frame rate is too fast for the exposure time, the program will throw an error.</li>
            <li>Auto exposure is not yet implemented.</li>
        </ul>
        
    </details>
    
    
    <h3>Fluigent</h3>
    <details>
      <summary>
          <span class="icon">▼</span><span class="open_text">Open</span><span class="close_text">Close</span>
      </summary>
        
        <img src="img/software_fluigent.png" class="graphic"  alt="Fluigent pressure controller module. The top section has buttons and fields to request specific pressures, indefinitely or for a finite time. The bottom section has a graph of pressure over time.">
        
        <ul>
            <li>To turn on the pressure for a certain channel on the Fluigent pressure controller, fill the "Set Pressure" box and either press [Enter] or click the top "Go" button, next to "indefinitely".</li>
            <li>To turn on the pressure for a certain channel on the Fluigent, fill the "Set Pressure" box, fill the "fixed time" box, and click the bottom "Go" button, next to "for fixed time".</li>
            <li>The bottom graph shows the recent pressure graph.</li>
        </ul>
        
        <img src="img/software_settings_fluigent.png" class="graphic" alt="The fluigent tab of the settings window. It contains options for how to show the pressure versus time plot.">
        <p>The settings box contains options for plotting and saving Fluigent data</p>
        
        <ul>
            <li>To save the table of pressure vs. time for the entire print, click the "Save pressure graph" checkbox.</li>
            <li>To change the frequency at which the software reads the pressure and stores it, change the "Time between readings" field.</li>
            <li>To change the length of time displayed on the plot, change the "Plot time range" field.</li>
            <li>To change the pressure range shown on the plot, from 0 to P, change the "Plot pressure range" field.</li>
            <li>To change the line color and caption color for a channel, change the "Channel color" field to a hex color value.</li>
        </ul>
            
        
    </details>
    
    <h3>SBP Files</h3>
    <details>
      <summary>
          <span class="icon">▼</span><span class="open_text">Open</span><span class="close_text">Close</span>
      </summary>
        
        <img src="img/shopbot_flags.png" alt="Flags within shobpot and their designated variables">
        
        <li>There are a total of 12 flags that can be assigned different variables for use with shopbot.</li>
        <ul>
            <li>Flags 1 and 2 are primarily for use with the extrudant</li>
            <li>Flags 3, 5, and 6 are connected to cameras</li>
            <li>Flag 12 is to run shopbot</li>
        </ul>
            
        <img src="img/sbpFile_example.png" alt="Beginning of a working sbp file for a sphere">
        
        <li>To turn a designated flag on, write 'SO, #, 1', where # is the flag number. To turn it off, write 'SO, #, 0'</li>
        <ul>
            <li>for the fluigent flags (1,2), write 'SO, # 1' to turn flow/pressure on. Write 'SO, #, 0' to turn flow/pressure off.</li>
            <li>The fluigent and run flags (1/2, 12) must be turned off at the end of the file. 'SO, 12, 0' is the very last line.</li>
        </ul>
        <li>Lines 1 to 10 are considered the header</li>
        <ul>
            <li>Each file must have the VD and VU commands placed first in the header. Theses commands designate Values for Display and Values for Values for Units. VU in simplicity tells the printer which way is up, with a negative Z value being considered positive/up.</li>
            <li>Move speed (MS) and Jump speed (JS) must also be assigned values within the header</li>
            <li>Then the values of ramp (VR) must be assigned</li>
            <li>For lines 9 and 10 in the example, an unused flag is being turned on/off to activate the system. This is needed after shopbot has started the run due to a glitch in the system.</li>
            <li>'SO, 12, 1' is needed to actually start the shopbot. If it is not included, your file will never run.</li>
        </ul>   
        <li>Each command must have a comma separating each variable. 'M3 3, 5, 6' will not work because there is a missing comma between the M3 and 3.</li>
        <ul>
            <li>If a command starts with an M, it is a move. So M3 moves to the designated X, Y, and Z coordinates.</li>
            <li>If a command starts with a J, it is a jump. So J2 jumps to the designated X and Y coordinates</li>
            <li>If a command starts with a V, it is a value setup.</li>
            <li>MH is the command for move home, or where the stage is considered to be (0, 0, 0)</li>
            <li>SA sets the file to be done in absolute distances/ absolute mode </li>
        </ul>   
        <li>ink speed is a comment (started with ') to let you know the flow rate of the extrudant</li>
    
        
    </details>
    
    <div style="height:100px"></div>
    
    
    </body>